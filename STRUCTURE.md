# Структура проекта:

## Корень проекта

Директории:

- `error_classes` - кастомные классы ошибок 
- `google_handlers` - обработчики Google Sheets и Google Docs
- `social_network_handlers` - обработчики API социальных сетей

Файлы:

- `.env` - переменные окружения 
- `.gitignore` - игнорирующиеся файлы, директории и т.д.
- `requirements.txt` - необходимые для работы скриптов библиотеки
- `service_account.json` - данные сервисного аккаунта Google
- `smm_planner.py` - основной исполняемый файл
- `README.md` - описание проекта
- `STRUCTURE.md` - описание структуры и методов проекта

## smm_planner.py - основной исполняемый файл

### `main`

Основной скрипт публикаций постов из Google Sheets

## Директория `error_classes`

### `error_classes.py`

- #### `class SocialNetworkError`

Кастомная ошибка для сбоев в работе социальных сетей

## Директория `google_handlers`

### `google_document_functions.py`

Коллекция скриптов обработки Google Documents

#### Метод получения текста и ссылки фото

* `download_google_document_text_and_image_url`<br><br>

  + Принимает: 
  
    - `link_google_document` - ссылка на Google Document<br><br> 

  + Возвращает:
  
    - `text_with_photo` - текст и ссылку на фото документа 

#### Метод парсинга документа

* `get_document_text_and_image_url`<br><br>

  + Принимает:

    - `document` - файл с документом<br><br>

  + Возвращает: 

    - `post_text.replace('*', '')` - текст документа
    - `image_url` - ссылка на фото в документе

#### Метод парсинга картинки

* `get_google_document_image_url`<br><br>

  + Принимает:

    - `doc_list` - список значений из скрипта Google Documents (который парсился шагом выше)
    - `scripts` - список скриптов Google Documents <br><br>

  + Возвращает:

    - `image_url` - ссылку на картинку

#### Метод загрузки картинки

* `download_posts_image`<br><br>

  + Принимает:
  
    - `image_url` - ссылку на картинку <br><br>

  + Возвращает:
    - При успехе - `image_file_name` - имя файла (по умолчанию - `image_file.png`)
    - При ошибке - `None`

### `google_document_functions.py`

Коллекция скриптов взаимодействий с Google Sheets.

Имеет следующие константы:

- `GOOGLE_CREDENTIALS` - авторизация Google Service Account
- `SPREADSHEET` - открытая таблица
- `WORKSHEET` - открытый лист таблицы
- Несколько основных цветов для окрашивания ячеек

#### Метод преобразования строкового значения даты в datetime

* `format_date`<br><br>

  + Принимает:
  
    - `str_date` - дату в формате строки<br><br>

  + Возвращает:
    - `date_` - дату в формате: день, месяц, год
    - `date_.strftime("%Y-%m-%d")` - дату в формате: год-месяц-день
    - `date_.strftime("%Y/%m/%d")` - дату в формате: год/месяц/день

#### Метод преобразования строкового значения времени в datetime

* `format_time`<br><br>

  + Принимает:
  
  `str_time` - время в формате строки<br><br>

  + Возвращает:
    - `time_` - время в формате: час:минуты
    - `time_.strftime("%H:%M")` - время в формате: час:минуты

#### Метод преобразования даты и времени в datetime формат

* `get_formatted_datetime`<br><br>

  + Принимает:
  
    - `post_date` - дата в формате datetime
    - `post_time` - время в формате datetime<br><br>

  + Возвращает:

    - `formatted_datetime` - общий формат даты и времени

#### Метод получения времени в момент вызова 

* `get_datetime_now`<br><br>

  + Возвращает:

    - `datetime(datetime_now.year, datetime_now.month, datetime_now.day,
    datetime_now.hour, datetime_now.minute)` - время с точностью до минут

#### Метод получения всех постов необходимых для отправки

С валидацией по неудачным постам и времени

* `get_all_new_posts`<br><br>

  + Возвращает:

    - `all_new_posts` - список постов необходимых для отправки

#### Метод получения всех записей из таблицы

* `get_all_records`<br><br>

  + Возвращает:

    - `all_records` - список всех записей таблицы

#### Метод обновления текста ячейки в таблице

* `post_cell_text`<br><br>

  + Принимает:

    - `row` - строка ячейки
    - `col` - столбец ячейки
    - `text` - на какой текст необходимо заменить (по умолчанию - '')

#### Метод окрашивания ячейки

* `format_cell`<br><br>

  + Принимает:

    - `row` - строка ячейки
    - `col` - столбец ячейки
    - `b_color` - цвет фона (формат RGB)
    - `f_color` - цвет переднего плана (формат RGB)

#### Метод форматирования чеклистов

* `put_mark`<br><br>

  + Принимает:

    - `row` - строка ячейки
    - `col` - столбец ячейки
    - `post_result` - сообщение (результат поста: id поста или ошибка поста)
    - `error` - флаг обработки ошибки (по умолчанию False)<br><br>

  + Примечание:
    - Флаг `error` используется для корректной отработки ошибок.
    На примере нашего кода этот флаг вызывается только единожды в,
    собственно, отработке кастомной ошибки

## Директория `social_networks_handlers`

### `ok_publication.py`

Коллекция функций публикации поста в Одноклассниках

#### `Получение индивидуальныех настроек пользователя`

* `get_ok_environs`<br><br>

  + Возвращает: 
    - `access_token` - access_token
    - `application_key` - ключ приложения
    - `application_secret_key` - секретный ключ приложения
    - `ok_user` - ID пользователя
    - `ok_application_id` - ID приложения OK
    - `album` - ID альбома

# TODO


#### get_ok_environs()
Получаем индивидуальные настройки пользователя.


#### convert_text_to_picture(text)
Формируем картинку с введенным текстом (нужно для варианта "сообщение без картинки")


#### publication_post_ok(post_text, image_file_name)
Публикуем картинку с подписью.
на входе
post_text текст сообщения
image_file_name путь до изображения (вариант "сообщение с картинкой")
В результате получаем опубликованную картинку в пользовательском альбоме, либо поднимается ошибка, которую обрабатывает вызывающая ппрограмма





### get_posts_text_imagefile(post_number)

Получение текста поста и изображения поста 

на входе:

post_number - номер поста

на выходе: 

post_text,- текст поста,  image_file_name - имя сохраненного временного файла изображения в корне проекта


## sheet_functions.py - функции работы с Гугл таблицей и Гугл Докс

#### format_date(str_date)
форматирование даты в тип date

#### format_time(str_time)
форматирование времени в тип time

#### get_all_posts()
получение всех записей таблицы - функцию можно развить далее с нюансами

#### get_all_records()
получение всех записей таблицы (щас используется)

#### get_all_times()
получение всех записей о времени публикации - наверно пригодится :) 

#### get_posts_count()
получение количества постов

#### post_cell_text(row, col, text='')
запись в ячейку с координатами текста

#### format_cell(row, col, b_color, f_color)
окраска ячейки с координатами: b_color, f_color - смотри константы:
BLACK = {'red': 0.0, 'green': 0.0, 'blue': 0.0}
WHITE = {'red': 1.0, 'green': 1.0, 'blue': 1.0}
GREEN = {'red': 0.0, 'green': 1.0, 'blue': 0.0}
RED = {'red': 1.0, 'green': 0.0, 'blue': 0.0}
можно добавить еще


#### get_post_text(post):
получение текста поста из Гугл Докс по номеру поста в таблице. Функция возвращает текст, временный файл сразу удаляется. 



# vk_publication.py - функции публикации поста Вконтакте
Все методы перечислены в справочнике для разработчиков ВК https://dev.vk.com/ 

## check_vk_request_error(response)
Получение текста ошибки ВК, если такая появилась (т.к. ВК всегда возвращает 200 - не ясно есть ли ошибка).
### входные данные:
response - ответ запроса к серверу ВК
### выходные данные:
при обнаружении в тексте ответа 'error' - вызывается исключение  


## get_photos_wall_upload_server(vk_access, vk_group_id)
Получение от API VK данных для загрузки сообщения на сервер.
### входные данные:
vk_access - данные для авторизации в ВК (https://dev.vk.com/api/api-requests)

vk_group_id - идентификатор сообщества, на стену которого нужно загрузить фотографии (без знака -).

### выходные данные:
album_id - идентификатор альбома, в который нужно загрузить фотографии

upload_url - адрес, по которому нужно загрузить фотографии.


## save_photo_to_wall(vk_access, vk_group_id, upload_url, file_path, post_file_name)
Сохранение сообщения на стене ВК (без публикации)

### входные данные:
vk_access, vk_group_id, upload_url - см. выше

file_path - путь до изображения на диске

post_file_name - имя файла с содержимым размещаемого сообщения

### выходные данные:
photo_owner_id - идентификатор хозяина загруженного сообщения

photo_id - идентификатор загруженного сообщения


## post_on_wall(vk_access, vk_group_id, post_alt, photo_owner_id, photo_id)
Публикация ранее сохраненной записи
### входные данные:
vk_access, vk_group_id - см. выше (здесь идентификатор сообщества должен начинаться со знака -)

post_alt - текст сообщения

photo_owner_id - идентификатор хозяина загруженного сообщения

photo_id - идентификатор загруженного сообщения

### выходные данные:
post_id - идентификатор записи

## delete_post_vk(post_id)
Удаление со стены сообщения

### входные данные:
post_id - идентификатор записи

### выходные данные:
Результат запроса к серверу response


## get_connect_params_vk()
Запрос данных для авторизации в ВК в файле переменных окружения ``.env``

### входные данные:
нет

### выходные данные:
vk_access_token, vk_group_id, vk_access

## publication_post_vk(post_text, image_file_name)
Функция публикации сообщения в ВК, объединяющая в себе предудыщие функции

### входные данные:
post_text - текст сообщения

image_file_name - имя файла изображения

### выходные данные:
post_id - номер размещенного сообщения, отдаваемый сервером соцсети

После публикации с диска удаляются файлы с изображением и текстом.


## ok_publication.py - функции публикации поста в Одноклассниках


#### get_ok_environs()
Получаем индивидуальные настройки пользователя.


#### convert_text_to_picture(text)
Формируем картинку с введенным текстом (нужно для варианта "сообщение без картинки")


#### publication_post_ok(post_text, image_file_name)
Публикуем картинку с подписью.
на входе
post_text текст сообщения
image_file_name путь до изображения (вариант "сообщение с картинкой")
В результате получаем опубликованную картинку в пользовательском альбоме, либо поднимается ошибка, которую обрабатывает вызывающая ппрограмма
