# Структура проекта:

## Корень проекта

Директории:

- `error_classes` - кастомные классы ошибок 
- `google_handlers` - обработчики Google Sheets и Google Docs
- `social_network_handlers` - обработчики API социальных сетей

Файлы:

- `.env` - переменные окружения 
- `.gitignore` - игнорирующиеся файлы, директории и т.д.
- `requirements.txt` - необходимые для работы скриптов библиотеки
- `service_account.json` - данные сервисного аккаунта Google
- `smm_planner.py` - основной исполняемый файл
- `README.md` - описание проекта
- `STRUCTURE.md` - описание структуры и методов проекта

## smm_planner.py - основной исполняемый файл

### `main`

Основной скрипт публикаций постов из Google Sheets

## Директория `error_classes`

### `error_classes.py`

- #### `class SocialNetworkError`

Кастомная ошибка для сбоев в работе социальных сетей

## Директория `google_handlers`

### `google_document_functions.py`

Коллекция скриптов обработки Google Documents

#### Метод получения текста и ссылки фото

* `download_google_document_text_and_image_url`<br><br>

  + Принимает: 
  
    - `link_google_document` - ссылка на Google Document<br><br> 

  + Возвращает:
  
    - `text_with_photo` - текст и ссылку на фото документа 

#### Метод парсинга документа

* `get_document_text_and_image_url`<br><br>

  + Принимает:

    - `document` - файл с документом<br><br>

  + Возвращает: 

    - `post_text.replace('*', '')` - текст документа
    - `image_url` - ссылка на фото в документе

#### Метод парсинга картинки

* `get_google_document_image_url`<br><br>

  + Принимает:

    - `doc_list` - список значений из скрипта Google Documents (который парсился шагом выше)
    - `scripts` - список скриптов Google Documents <br><br>

  + Возвращает:

    - `image_url` - ссылку на картинку

#### Метод загрузки картинки

* `download_posts_image`<br><br>

  + Принимает:
  
    - `image_url` - ссылку на картинку <br><br>

  + Возвращает:
    - При успехе - `image_file_name` - имя файла (по умолчанию - `image_file.png`)
    - При ошибке - `None`

### `google_document_functions.py`

Коллекция скриптов взаимодействий с Google Sheets.

Имеет следующие константы:

- `GOOGLE_CREDENTIALS` - авторизация Google Service Account
- `SPREADSHEET` - открытая таблица
- `WORKSHEET` - открытый лист таблицы
- Несколько основных цветов для окрашивания ячеек

#### Метод преобразования строкового значения даты в datetime

* `format_date`<br><br>

  + Принимает:
  
    - `str_date` - дату в формате строки<br><br>

  + Возвращает:
    - `date_` - дату в формате: день, месяц, год
    - `date_.strftime("%Y-%m-%d")` - дату в формате: год-месяц-день
    - `date_.strftime("%Y/%m/%d")` - дату в формате: год/месяц/день

#### Метод преобразования строкового значения времени в datetime

* `format_time`<br><br>

  + Принимает:
  
  `str_time` - время в формате строки<br><br>

  + Возвращает:
    - `time_` - время в формате: час:минуты
    - `time_.strftime("%H:%M")` - время в формате: час:минуты

#### Метод преобразования даты и времени в datetime формат

* `get_formatted_datetime`<br><br>

  + Принимает:
  
    - `post_date` - дата в формате datetime
    - `post_time` - время в формате datetime<br><br>

  + Возвращает:

    - `formatted_datetime` - общий формат даты и времени

#### Метод получения времени в момент вызова 

* `get_datetime_now`<br><br>

  + Возвращает:

    - `datetime(datetime_now.year, datetime_now.month, datetime_now.day,
    datetime_now.hour, datetime_now.minute)` - время с точностью до минут

#### Метод получения всех постов необходимых для отправки

С валидацией по неудачным постам и времени

* `get_all_new_posts`<br><br>

  + Возвращает:

    - `all_new_posts` - список постов необходимых для отправки

#### Метод получения всех записей из таблицы

* `get_all_records`<br><br>

  + Возвращает:

    - `all_records` - список всех записей таблицы

#### Метод обновления текста ячейки в таблице

* `post_cell_text`<br><br>

  + Принимает:

    - `row` - строка ячейки
    - `col` - столбец ячейки
    - `text` - на какой текст необходимо заменить (по умолчанию - '')

#### Метод окрашивания ячейки

* `format_cell`<br><br>

  + Принимает:

    - `row` - строка ячейки
    - `col` - столбец ячейки
    - `b_color` - цвет фона (формат RGB)
    - `f_color` - цвет переднего плана (формат RGB)

#### Метод форматирования чеклистов

* `put_mark`<br><br>

  + Принимает:

    - `row` - строка ячейки
    - `col` - столбец ячейки
    - `post_result` - сообщение (результат поста: id поста или ошибка поста)
    - `error` - флаг обработки ошибки (по умолчанию False)<br><br>

  + Примечание:
    - Флаг `error` используется для корректной отработки ошибок.
    На примере нашего кода этот флаг вызывается только единожды в,
    собственно, отработке кастомной ошибки

## Директория `social_networks_handlers`

### `ok_publication.py`

Коллекция функций публикации поста в Одноклассниках

#### `Получение индивидуальныех настроек пользователя`

* `get_ok_environs`<br><br>

  + Возвращает: 
    - `access_token` - access_token
    - `application_key` - ключ приложения
    - `application_secret_key` - секретный ключ приложения
    - `ok_user` - ID пользователя
    - `ok_application_id` - ID приложения OK
    - `album` - ID альбома

#### `Создание картинки с введенным текстом`

Нужно для поста типа "сообщение без картинки" (специфика ОК)

* `convert_text_to_picture`<br><br>

  + Принимает:

    - `text` - текст поста
    - `image_file_name` - имя файла с картинкой<br><br>

  + Возвращает:

    - `image_file_name` - имя файла с текстом в картинке

#### `Публикация картинки с подписью в пользовательский альбом`

* `publication_post_ok`<br><br>

  + Принимает:

    - `text` - текст поста
    - `image_file_name` - имя файла с картинкой<br><br>

  + Возвращает:

    - `photo_id` - ID загруженного фото

### `vk_publication.py`

Коллекция функций публикации поста в VK

#### `Проверка ответа от VK API на наличие ошибок`

* `check_vk_request_error`<br><br>

  + Принимает: 
    - `response` - ответ запроса к серверу ВК<br><br>

  + Возвращает:
    - `SocialNetworkError(f'Ошибка сервиса ВКонтакте {error_message}')`, в случае, если имеется ошибка

#### `Получение от API VK данных для загрузки сообщения на сервер`

* `get_photos_wall_upload_server`<br><br>

  + Принимает:
    - `vk_access` - [данные для авторизации в ВК](https://dev.vk.com/api/api-requests)
    - `vk_group_id` - ID сообщества, на стену которого нужно загрузить фотографии (без знака -)<br><br>

  + Возвращает:
    - `album_id` - ID альбома, в который нужно загрузить фотографии
    - `upload_url` - адрес, по которому нужно загрузить фотографии

#### `Сохранение сообщения на стене ВК (не публикация)`

* `save_photo_to_wall`<br><br>

  + Принимает:
    - `vk_access` - [данные для авторизации в ВК](https://dev.vk.com/api/api-requests)
    - `vk_group_id` - ID сообщества, на стену которого нужно загрузить фотографии (без знака -)
    - `upload_url` - адрес, по которому нужно загрузить фотографии
    - `file_path` - путь до изображения на диске
    - `post_file_name` - имя файла с содержимым размещаемого сообщения<br><br>

  + Возвращает:
    - `photo_owner_id` - ID владельца загруженного сообщения
    - `photo_id` - ID загруженной фотографии

#### `Публикация сохраненной записи`

* `post_on_wall`<br><br>

  + Принимает:
    - `vk_access` - [данные для авторизации в ВК](https://dev.vk.com/api/api-requests)
    - `vk_group_id` - ID сообщества, на стену которого нужно загрузить фотографии (с знаком -)
    - `post_alt` - текст сообщения
    - `photo_owner_id` - ID владельца загруженного сообщения 
    - `photo_id` - ID загруженной фотографии<br><br>

  + Возвращает:
    - `post_id` - ID поста


#### `Удаление со стены сообщения`

* `delete_post_vk`<br><br>

  + Принимает:
    - `post_id` - ID поста<br><br>
  
  + Возвращает:
    - `response` - ответ от сервера

#### `Запрос данных для авторизации в ВК в файле переменных окружения .env`

* `get_connect_params_vk`<br><br>

  + Возвращает:
    - `vk_access_token` - токен доступа
    - `vk_group_id` - ID сообщества
    - `vk_access` - [данные для авторизации в ВК](https://dev.vk.com/api/api-requests)

#### `Функция публикации сообщения в ВК, объединяющая в себе предудыщие функции`

* `publication_post_vk`<br><br>

  + Получает:
    - `post_text` - текст сообщения
    - `image_file_name` - имя файла изображения<br><br>
  
  + Возвращает:
    - `post_id` - ID поста

### `tg_publication.py`

Коллекция функций публикации поста в Telegram

#### `Публикация поста в Telegram`

* `send_telegram_post`<br><br>

  + Принимает:
    - `post_text` - текст сообщения
    - `image_name` - имя файла изображения<br><br>

  + Возвращает: 
    - `message_id` - ID отправленного сообщения

#### `Удаление поста в Telegram`

* `delete_telegram_post`<br><br>

  + Принимает:
    - `message_id` - ID сообщения, который нужно удалить
  
#### `Получение ID поста в Telegram`

* `get_telegram_message_id`<br><br>

  + Принимает:
    - `message` - сообщение формата [Message](https://core.telegram.org/bots/api#message)<br><br>

  + Возвращает:
    - `message_id` - если пост был один
    - `ids` - если постов было несколько

#### `Получение переменных окружения для Telegram`

* `get_telegram_environs`<br><br>

  + Возвращает:
    - `telegram_bot_token` - токен бота
    - `telegram_chat_id` - ID чата<br><br>
  
  + Примечание:
    - У бота обязательно должны быть права администратора в чате
